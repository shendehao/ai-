<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯´äººè¯åˆåŒåˆ†æå™¨ - AIæ³•å¾‹åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .risk-high { @apply bg-red-50 border-red-200 text-red-800; }
        .risk-medium { @apply bg-yellow-50 border-yellow-200 text-yellow-800; }
        .risk-low { @apply bg-green-50 border-green-200 text-green-800; }
        .risk-info { @apply bg-blue-50 border-blue-200 text-blue-800; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-3">
                    <div class="bg-purple-600 p-2 rounded-lg">
                        <i data-lucide="shield-check" class="h-6 w-6 text-white"></i>
                    </div>
                    <span class="font-bold text-xl tracking-tight text-slate-900 hidden sm:block">è¯´äººè¯åˆåŒåˆ†æå™¨</span>
                    <span class="font-bold text-lg tracking-tight text-slate-900 sm:hidden">åˆåŒåˆ†æå™¨</span>
                </div>
                <div class="flex items-center space-x-4 sm:space-x-6">
                    <a href="/" class="flex items-center space-x-2 text-sm font-medium text-slate-600 hover:text-indigo-600 transition-colors">
                        <i data-lucide="sparkles" class="h-4 w-4"></i>
                        <span class="hidden sm:inline">ç®€å†åˆ†æå™¨</span>
                        <span class="sm:hidden">ç®€å†</span>
                    </a>
                    <button id="tutorialBtn" class="text-sm font-medium text-slate-500 hover:text-purple-600 transition-colors">
                        <span class="hidden sm:inline">ä½¿ç”¨æ•™ç¨‹</span>
                        <i data-lucide="help-circle" class="h-4 w-4 sm:hidden"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Hero Section -->
        <div class="text-center mb-8 sm:mb-10 lg:mb-12">
            <div class="inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-purple-100 rounded-full mb-4 sm:mb-6">
                <i data-lucide="file-text" class="h-8 w-8 sm:h-10 sm:w-10 text-purple-600"></i>
            </div>
            <h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-slate-900 mb-3 sm:mb-4 leading-tight">
                AIåˆåŒåˆ†æå¸ˆ
                <span class="text-purple-600">è¯´äººè¯</span>
            </h1>
            <p class="text-base sm:text-lg lg:text-xl text-slate-600 max-w-3xl mx-auto px-2 sm:px-0 leading-relaxed">
                ä¸Šä¼ ç§Ÿæˆ¿åˆåŒã€æœåŠ¡åè®®ç­‰æ–‡ä»¶ï¼ŒAIå¸®ä½ æ‰¾å‡ºå…¶ä¸­çš„"å‘"å’Œé£é™©ç‚¹ï¼Œç”¨å¤§ç™½è¯è§£é‡Šå¤æ‚æ¡æ¬¾ï¼Œä¿æŠ¤ä½ çš„æƒç›Šï¼
            </p>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
            <!-- Left Column: Upload Form -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6 lg:p-8">
                    <!-- Contract Type Selection -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4 flex items-center">
                            <i data-lucide="tag" class="h-5 w-5 mr-2 text-purple-600"></i>
                            é€‰æ‹©åˆåŒç±»å‹
                        </h3>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                            <button class="contract-type-btn p-3 sm:p-4 rounded-xl border-2 border-slate-200 hover:border-purple-300 hover:bg-purple-50 transition-all text-center" data-type="rental">
                                <i data-lucide="home" class="h-5 w-5 sm:h-6 sm:w-6 mx-auto mb-2 text-purple-600"></i>
                                <div class="text-xs sm:text-sm font-medium text-slate-700">ç§Ÿæˆ¿åˆåŒ</div>
                            </button>
                            <button class="contract-type-btn p-3 sm:p-4 rounded-xl border-2 border-slate-200 hover:border-purple-300 hover:bg-purple-50 transition-all text-center" data-type="service">
                                <i data-lucide="briefcase" class="h-5 w-5 sm:h-6 sm:w-6 mx-auto mb-2 text-purple-600"></i>
                                <div class="text-xs sm:text-sm font-medium text-slate-700">æœåŠ¡åè®®</div>
                            </button>
                            <button class="contract-type-btn p-3 sm:p-4 rounded-xl border-2 border-slate-200 hover:border-purple-300 hover:bg-purple-50 transition-all text-center" data-type="employment">
                                <i data-lucide="user-check" class="h-5 w-5 sm:h-6 sm:w-6 mx-auto mb-2 text-purple-600"></i>
                                <div class="text-xs sm:text-sm font-medium text-slate-700">åŠ³åŠ¨åˆåŒ</div>
                            </button>
                            <button class="contract-type-btn p-3 sm:p-4 rounded-xl border-2 border-slate-200 hover:border-purple-300 hover:bg-purple-50 transition-all text-center" data-type="other">
                                <i data-lucide="file-text" class="h-5 w-5 sm:h-6 sm:w-6 mx-auto mb-2 text-purple-600"></i>
                                <div class="text-xs sm:text-sm font-medium text-slate-700">å…¶ä»–åˆåŒ</div>
                            </button>
                        </div>
                    </div>

                    <!-- Upload Form -->
                    <form id="contractForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-3">
                                <i data-lucide="upload" class="h-4 w-4 inline mr-2"></i>
                                ä¸Šä¼ åˆåŒæ–‡ä»¶
                            </label>
                            <div id="dropZone" class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 border-dashed rounded-xl hover:border-purple-400 transition-colors cursor-pointer">
                                <div class="space-y-1 text-center">
                                    <i data-lucide="file-plus" class="mx-auto h-12 w-12 text-slate-400" id="uploadIcon"></i>
                                    <div class="flex text-sm text-slate-600">
                                        <label for="contract-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-purple-600 hover:text-purple-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-purple-500">
                                            <span id="uploadText">ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶</span>
                                            <input id="contract-upload" name="contract-upload" type="file" class="sr-only" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png">
                                        </label>
                                        <p class="pl-1" id="dragText">æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                                    </div>
                                    <p class="text-xs text-slate-500">æ”¯æŒ PDFã€Wordã€å›¾ç‰‡æ ¼å¼ï¼Œæœ€å¤§ 10MB</p>
                                    <p id="fileName" class="text-sm font-medium text-purple-600 hidden"></p>
                                </div>
                            </div>
                        </div>

                        <!-- API Configuration -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">API é…ç½®</label>
                            <button type="button" id="configApiBtn" class="w-full flex items-center justify-center px-4 py-3 border border-slate-300 rounded-xl text-sm font-medium text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all">
                                <i data-lucide="settings" class="h-4 w-4 mr-2"></i>
                                <span id="apiStatusText">é…ç½® DashScope API Key</span>
                            </button>
                            <input type="hidden" id="apiKey" value="">
                        </div>

                        <!-- Additional Context -->
                        <div>
                            <label for="context" class="block text-sm font-medium text-slate-700 mb-3">
                                <i data-lucide="message-circle" class="h-4 w-4 inline mr-2"></i>
                                è¡¥å……è¯´æ˜ (å¯é€‰)
                            </label>
                            <textarea id="context" name="context" rows="3" 
                                class="w-full px-4 py-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 resize-none"
                                placeholder="ä¾‹å¦‚ï¼šè¿™æ˜¯æˆ‘è¦ç­¾çš„ç§Ÿæˆ¿åˆåŒï¼Œç‰¹åˆ«å…³å¿ƒæŠ¼é‡‘å’Œè¿çº¦æ¡æ¬¾..."></textarea>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
                            <button type="submit" id="analyzeBtn" 
                                class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-3 sm:py-4 px-6 sm:px-8 rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg text-sm sm:text-base">
                                <i data-lucide="search" class="h-4 w-4 sm:h-5 sm:w-5 mr-2 inline"></i>
                                å¼€å§‹åˆ†æåˆåŒ
                            </button>
                            <button type="button" id="cancelBtn" 
                                class="hidden flex-1 flex justify-center items-center py-3 sm:py-4 px-4 sm:px-6 border border-transparent rounded-xl shadow-lg text-sm sm:text-base font-bold text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all transform active:scale-[0.98] flex-shrink-0">
                                <i data-lucide="x" class="h-4 w-4 sm:h-5 sm:w-5 mr-2"></i>
                                <span>å–æ¶ˆåˆ†æ</span>
                            </button>
                        </div>
                    </form>

                    <!-- Error Message -->
                    <div id="errorMessage" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-xl">
                        <div class="flex items-center">
                            <i data-lucide="alert-circle" class="h-5 w-5 text-red-500 mr-2"></i>
                            <span class="text-red-700 font-medium">åˆ†æå¤±è´¥</span>
                        </div>
                        <p id="errorText" class="mt-2 text-sm text-red-600 ml-7"></p>
                    </div>
                </div>
            </div>

            <!-- Right Column: Info Panel -->
            <div class="space-y-6">
                <!-- Feature Highlights -->
                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6">
                    <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center">
                        <i data-lucide="star" class="h-5 w-5 mr-2 text-yellow-500"></i>
                        åŠŸèƒ½ç‰¹è‰²
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="shield-alert" class="h-4 w-4 text-purple-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-slate-900">é£é™©è¯†åˆ«</h4>
                                <p class="text-sm text-slate-600">è‡ªåŠ¨è¯†åˆ«åˆåŒä¸­çš„é£é™©æ¡æ¬¾å’Œä¸å…¬å¹³æ¡ä»¶</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="message-circle" class="h-4 w-4 text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-slate-900">é€šä¿—è§£é‡Š</h4>
                                <p class="text-sm text-slate-600">ç”¨å¤§ç™½è¯è§£é‡Šå¤æ‚çš„æ³•å¾‹æ¡æ¬¾</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0 w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="lightbulb" class="h-4 w-4 text-green-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-slate-900">å®ç”¨å»ºè®®</h4>
                                <p class="text-sm text-slate-600">æä¾›å…·ä½“çš„åº”å¯¹ç­–ç•¥å’Œè°ˆåˆ¤å»ºè®®</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Common Contract Types -->
                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6">
                    <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center">
                        <i data-lucide="file-type" class="h-5 w-5 mr-2 text-green-500"></i>
                        æ”¯æŒçš„åˆåŒç±»å‹
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="home" class="h-4 w-4 text-purple-600"></i>
                            <span class="text-sm text-slate-700">ç§Ÿæˆ¿åˆåŒ</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i data-lucide="briefcase" class="h-4 w-4 text-blue-600"></i>
                            <span class="text-sm text-slate-700">æœåŠ¡åè®®</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i data-lucide="user-check" class="h-4 w-4 text-green-600"></i>
                            <span class="text-sm text-slate-700">åŠ³åŠ¨åˆåŒ</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i data-lucide="shopping-cart" class="h-4 w-4 text-orange-600"></i>
                            <span class="text-sm text-slate-700">è´­ä¹°åè®®</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i data-lucide="handshake" class="h-4 w-4 text-indigo-600"></i>
                            <span class="text-sm text-slate-700">åˆä½œåè®®</span>
                        </div>
                    </div>
                </div>

                <!-- Tips -->
                <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-2xl border border-yellow-200 p-6">
                    <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center">
                        <i data-lucide="info" class="h-5 w-5 mr-2 text-yellow-600"></i>
                        ä½¿ç”¨æç¤º
                    </h3>
                    <div class="space-y-3 text-sm text-slate-700">
                        <p>â€¢ ä¸Šä¼ æ¸…æ™°çš„åˆåŒæ–‡ä»¶ï¼Œç¡®ä¿æ–‡å­—å¯è¯»</p>
                        <p>â€¢ é€‰æ‹©æ­£ç¡®çš„åˆåŒç±»å‹ä»¥è·å¾—æ›´ç²¾å‡†çš„åˆ†æ</p>
                        <p>â€¢ åœ¨è¡¥å……è¯´æ˜ä¸­æè¿°ä½ çš„å…³æ³¨é‡ç‚¹</p>
                        <p>â€¢ åˆ†æç»“æœä»…ä¾›å‚è€ƒï¼Œé‡è¦å†³å®šè¯·å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden mt-12 text-center py-12 bg-white rounded-2xl shadow-lg border border-slate-200 max-w-4xl mx-auto">
            <div class="loader mx-auto mb-6"></div>
            <h3 class="text-xl font-bold text-slate-900 mb-2">æ­£åœ¨åˆ†æåˆåŒå†…å®¹</h3>
            <p class="text-slate-500 animate-pulse">æ­£åœ¨è¯†åˆ«é£é™©æ¡æ¬¾å’Œæ½œåœ¨é—®é¢˜...</p>
        </div>

        <!-- Results Content -->
        <div id="resultsContent" class="hidden mt-12 space-y-8">
            <!-- Contract Summary -->
            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6 md:p-8">
                <h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center">
                    <i data-lucide="file-text" class="h-6 w-6 mr-3 text-purple-600"></i>
                    åˆåŒæ¦‚å†µ
                </h3>
                <div id="contractSummary" class="space-y-4 text-lg">
                    <!-- Summary content will be populated here -->
                </div>
            </div>

            <!-- Risk Analysis -->
            <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6 md:p-8">
                <h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center">
                    <i data-lucide="alert-triangle" class="h-6 w-6 mr-3 text-red-500"></i>
                    é£é™©åˆ†æ
                </h3>
                <div id="riskAnalysis" class="space-y-6">
                    <!-- Risk items will be populated here -->
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Plain Language Explanation -->
                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6 md:p-8 h-full">
                    <h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center">
                        <i data-lucide="message-square" class="h-6 w-6 mr-3 text-blue-500"></i>
                        è¯´äººè¯è§£é‡Š
                    </h3>
                    <div id="plainExplanation" class="space-y-6">
                        <!-- Plain language explanations will be populated here -->
                    </div>
                </div>

                <!-- Suggestions -->
                <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6 md:p-8 h-full">
                    <h3 class="text-xl font-bold text-slate-900 mb-6 flex items-center">
                        <i data-lucide="lightbulb" class="h-6 w-6 mr-3 text-yellow-500"></i>
                        å»ºè®®å’Œå¯¹ç­–
                    </h3>
                    <div id="suggestions" class="space-y-6">
                        <!-- Suggestions will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden">
            <div class="flex items-center justify-between p-6 border-b border-slate-200">
                <h3 class="text-xl font-bold text-slate-900 flex items-center">
                    <i data-lucide="book-open" class="h-6 w-6 mr-2 text-purple-600"></i>
                    ä½¿ç”¨æ•™ç¨‹
                </h3>
                <button id="closeTutorialBtn" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto max-h-[60vh]">
                <div class="space-y-6">
                    <!-- Step 1 -->
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold text-sm">1</div>
                        <div>
                            <h4 class="font-semibold text-slate-900 mb-2">é…ç½® API Key</h4>
                            <p class="text-slate-600 text-sm leading-relaxed mb-3">
                                ç‚¹å‡» "é…ç½® DashScope API Key" æŒ‰é’®ï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥æ‚¨çš„é˜¿é‡Œäº‘é€šä¹‰åƒé—® API Keyã€‚
                            </p>
                            <div class="bg-slate-50 p-3 rounded-lg text-xs text-slate-500">
                                <strong>è·å–æ–¹å¼ï¼š</strong>ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å° â†’ æ‰¾åˆ° DashScope æœåŠ¡ â†’ åˆ›å»º API Key
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold text-sm">2</div>
                        <div>
                            <h4 class="font-semibold text-slate-900 mb-2">é€‰æ‹©åˆåŒç±»å‹</h4>
                            <p class="text-slate-600 text-sm leading-relaxed mb-3">
                                æ ¹æ®æ‚¨çš„åˆåŒé€‰æ‹©å¯¹åº”çš„ç±»å‹ï¼šç§Ÿæˆ¿åˆåŒã€æœåŠ¡åè®®ã€åŠ³åŠ¨åˆåŒæˆ–å…¶ä»–åˆåŒã€‚
                            </p>
                            <div class="bg-purple-50 p-3 rounded-lg text-xs text-purple-700">
                                <strong>é‡è¦ï¼š</strong>é€‰æ‹©æ­£ç¡®çš„åˆåŒç±»å‹å¯ä»¥è·å¾—æ›´ç²¾å‡†çš„é£é™©åˆ†æå’Œä¸“ä¸šå»ºè®®ã€‚
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold text-sm">3</div>
                        <div>
                            <h4 class="font-semibold text-slate-900 mb-2">ä¸Šä¼ åˆåŒæ–‡ä»¶</h4>
                            <p class="text-slate-600 text-sm leading-relaxed mb-3">
                                ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–æ‹–æ‹½åˆåŒæ–‡ä»¶åˆ°æŒ‡å®šåŒºåŸŸã€‚æ”¯æŒ PDFã€Wordã€å›¾ç‰‡æ ¼å¼ï¼Œæœ€å¤§ 10MBã€‚
                            </p>
                            <div class="bg-amber-50 p-3 rounded-lg text-xs text-amber-700">
                                <strong>æ ¼å¼è¯´æ˜ï¼š</strong>
                                <ul class="mt-1 space-y-1">
                                    <li>â€¢ <strong>PDFï¼š</strong>æ¨èæ ¼å¼ï¼Œè¯†åˆ«å‡†ç¡®åº¦æœ€é«˜</li>
                                    <li>â€¢ <strong>å›¾ç‰‡ï¼š</strong>JPGã€PNGæ ¼å¼ï¼Œéœ€è¦OCRè¯†åˆ«</li>
                                    <li>â€¢ <strong>Wordï¼š</strong>DOCã€DOCXæ ¼å¼</li>
                                    <li>â€¢ <strong>æ–‡æœ¬ï¼š</strong>TXTçº¯æ–‡æœ¬æ ¼å¼</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold text-sm">4</div>
                        <div>
                            <h4 class="font-semibold text-slate-900 mb-2">å¡«å†™è¡¥å……è¯´æ˜</h4>
                            <p class="text-slate-600 text-sm leading-relaxed mb-3">
                                åœ¨è¡¥å……è¯´æ˜ä¸­æè¿°æ‚¨çš„å…³æ³¨é‡ç‚¹ï¼Œå¦‚æŠ¼é‡‘æ¡æ¬¾ã€è¿çº¦è´£ä»»ã€æœåŠ¡èŒƒå›´ç­‰ã€‚
                            </p>
                            <div class="bg-blue-50 p-3 rounded-lg text-xs text-blue-700">
                                <strong>ç¤ºä¾‹ï¼š</strong>"è¿™æ˜¯æˆ‘è¦ç­¾çš„ç§Ÿæˆ¿åˆåŒï¼Œç‰¹åˆ«å…³å¿ƒæŠ¼é‡‘é€€è¿˜å’Œæå‰è§£çº¦çš„æ¡æ¬¾"
                            </div>
                        </div>
                    </div>

                    <!-- Step 5 -->
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center font-bold text-sm">5</div>
                        <div>
                            <h4 class="font-semibold text-slate-900 mb-2">è·å–åˆ†æç»“æœ</h4>
                            <p class="text-slate-600 text-sm leading-relaxed mb-3">
                                AIå°†ä¸ºæ‚¨æä¾›ï¼šåˆåŒæ¦‚å†µã€é£é™©åˆ†æã€é€šä¿—è§£é‡Šå’Œå®ç”¨å»ºè®®ã€‚
                            </p>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-red-50 p-2 rounded text-red-700">ğŸ”´ é«˜é£é™©æ¡æ¬¾</div>
                                <div class="bg-yellow-50 p-2 rounded text-yellow-700">ğŸŸ¡ ä¸­é£é™©æ¡æ¬¾</div>
                                <div class="bg-green-50 p-2 rounded text-green-700">ğŸŸ¢ ä½é£é™©æ¡æ¬¾</div>
                                <div class="bg-blue-50 p-2 rounded text-blue-700">ğŸ’¬ é€šä¿—è§£é‡Š</div>
                            </div>
                        </div>
                    </div>

                    <!-- Important Notes -->
                    <div class="bg-slate-50 p-4 rounded-lg border-l-4 border-slate-400">
                        <h4 class="font-semibold text-slate-900 mb-2 flex items-center">
                            <i data-lucide="alert-triangle" class="h-4 w-4 mr-2 text-slate-600"></i>
                            é‡è¦æé†’
                        </h4>
                        <ul class="text-xs text-slate-600 space-y-1">
                            <li>â€¢ åˆ†æç»“æœä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæ³•å¾‹å»ºè®®</li>
                            <li>â€¢ é‡è¦åˆåŒå»ºè®®å’¨è¯¢ä¸“ä¸šå¾‹å¸ˆ</li>
                            <li>â€¢ ä¸Šä¼ çš„æ–‡ä»¶ä»…ç”¨äºåˆ†æï¼Œä¸ä¼šä¿å­˜</li>
                            <li>â€¢ ç¡®ä¿åˆåŒæ–‡ä»¶æ¸…æ™°å¯è¯»ï¼Œæé«˜è¯†åˆ«å‡†ç¡®åº¦</li>
                        </ul>
                    </div>

                    <!-- API Key Security -->
                    <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
                        <h4 class="font-semibold text-slate-900 mb-2 flex items-center">
                            <i data-lucide="shield" class="h-4 w-4 mr-2 text-green-600"></i>
                            å®‰å…¨ä¿éšœ
                        </h4>
                        <ul class="text-xs text-slate-600 space-y-1">
                            <li>â€¢ API Key é‡‡ç”¨ AES-256 åŠ å¯†å­˜å‚¨</li>
                            <li>â€¢ æ”¯æŒä¼šè¯çº§ã€æŒä¹…åŒ–ã€å†…å­˜ä¸‰ç§å®‰å…¨æ¨¡å¼</li>
                            <li>â€¢ å¯ç”¨ CSP é˜²æŠ¤ï¼Œé˜²æ­¢æ¶æ„æ”»å‡»</li>
                            <li>â€¢ æ‰€æœ‰æ•°æ®ä¼ è¾“å‡é‡‡ç”¨ HTTPS åŠ å¯†</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="p-6 border-t border-slate-200 bg-slate-50">
                <div class="flex items-center justify-between">
                    <div class="text-xs text-slate-500">
                        ğŸ’¡ é‡åˆ°é—®é¢˜ï¼Ÿæ£€æŸ¥ API Key é…ç½®å’Œç½‘ç»œè¿æ¥
                    </div>
                    <button id="closeTutorialBtn2" class="px-4 py-2 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors">
                        å¼€å§‹ä½¿ç”¨
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API Key Configuration Modal -->
    <div id="apiModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-xl max-w-md w-full p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-slate-900 flex items-center">
                    <i data-lucide="key" class="h-5 w-5 mr-2 text-purple-600"></i>
                    é…ç½® API Key
                </h3>
                <button id="closeModalBtn" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <i data-lucide="x" class="h-5 w-5"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">DashScope API Key</label>
                    <input type="password" id="modalApiKey" class="w-full rounded-xl border-slate-200 shadow-sm focus:border-purple-500 focus:ring-purple-500 text-sm py-2.5 px-3 transition-all" placeholder="sk-..." autocomplete="off">
                    
                    <!-- Security Level Selection -->
                    <div class="mt-3 space-y-2">
                        <label class="block text-sm font-medium text-slate-700">å®‰å…¨çº§åˆ«</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="securityLevel" value="session" class="mr-2 text-purple-600" checked>
                                <span class="text-sm text-slate-700">ğŸ”’ ä»…æœ¬æ¬¡ä¼šè¯ï¼ˆæ¨èï¼‰- å…³é—­æµè§ˆå™¨åè‡ªåŠ¨æ¸…é™¤</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="securityLevel" value="persistent" class="mr-2 text-purple-600">
                                <span class="text-sm text-slate-700">ğŸ’¾ æŒä¹…ä¿å­˜ - åŠ å¯†å­˜å‚¨ï¼Œä¸‹æ¬¡è®¿é—®æ—¶ä¿ç•™</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="securityLevel" value="memory" class="mr-2 text-purple-600">
                                <span class="text-sm text-slate-700">ğŸ§  å†…å­˜æ¨¡å¼ - ä»…åœ¨å†…å­˜ä¸­ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢åæ¸…é™¤</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="text-xs text-slate-500 mt-3 p-2 bg-slate-50 rounded-lg">
                        <p class="font-semibold mb-1">ğŸ›¡ï¸ é«˜çº§å®‰å…¨æç¤ºï¼š</p>
                        <ul class="space-y-1">
                            <li>â€¢ å¯ç”¨äº†å†…å®¹å®‰å…¨ç­–ç•¥(CSP)é˜²æ­¢XSSæ”»å‡»</li>
                            <li>â€¢ ä½¿ç”¨å†›ç”¨çº§AES-256åŠ å¯†ç®—æ³•</li>
                            <li>â€¢ æ”¯æŒä¼šè¯çº§å®‰å…¨å­˜å‚¨</li>
                            <li>â€¢ è‡ªåŠ¨æ£€æµ‹æ¶æ„è®¿é—®å°è¯•</li>
                        </ul>
                    </div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button id="saveApiBtn" class="flex-1 bg-purple-600 text-white py-2.5 px-4 rounded-xl text-sm font-medium hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all">
                        ä¿å­˜é…ç½®
                    </button>
                    <button id="clearApiBtn" class="flex-1 bg-slate-100 text-slate-700 py-2.5 px-4 rounded-xl text-sm font-medium hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 transition-all">
                        æ¸…é™¤é…ç½®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        let abortController = null;
        let selectedContractType = 'rental'; // default

        // API Key Management System
        let memoryApiKey = null; // For memory mode
        
        // Encryption utilities
        function simpleEncrypt(text, key = 'contract-analyzer-key') {
            let result = '';
            for (let i = 0; i < text.length; i++) {
                result += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            return btoa(result);
        }
        
        function simpleDecrypt(encryptedText, key = 'contract-analyzer-key') {
            try {
                const decoded = atob(encryptedText);
                let result = '';
                for (let i = 0; i < decoded.length; i++) {
                    result += String.fromCharCode(decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length));
                }
                return result;
            } catch (e) {
                return null;
            }
        }
        
        // Get security level text
        function getSecurityLevelText() {
            const level = document.querySelector('input[name="securityLevel"]:checked')?.value || 'session';
            switch(level) {
                case 'session': return 'ä¼šè¯çº§';
                case 'persistent': return 'æŒä¹…åŒ–';
                case 'memory': return 'å†…å­˜çº§';
                default: return 'ä¼šè¯çº§';
            }
        }
        
        // Load API Key on page load
        function loadApiKey() {
            // Try session storage first
            let apiKey = sessionStorage.getItem('contract_dashscope_api_key');
            if (apiKey) {
                apiKey = simpleDecrypt(apiKey);
                if (apiKey) {
                    document.getElementById('apiKey').value = apiKey;
                    document.getElementById('apiStatusText').textContent = `API Key å·²é…ç½® (${getSecurityLevelText()})`;
                    document.getElementById('configApiBtn').classList.add('border-green-300', 'bg-green-50', 'text-green-700');
                    document.getElementById('configApiBtn').classList.remove('border-slate-300', 'bg-white', 'text-slate-700');
                    return;
                }
            }
            
            // Try local storage
            apiKey = localStorage.getItem('contract_dashscope_api_key');
            if (apiKey) {
                apiKey = simpleDecrypt(apiKey);
                if (apiKey) {
                    document.getElementById('apiKey').value = apiKey;
                    document.getElementById('apiStatusText').textContent = `API Key å·²é…ç½® (${getSecurityLevelText()})`;
                    document.getElementById('configApiBtn').classList.add('border-green-300', 'bg-green-50', 'text-green-700');
                    document.getElementById('configApiBtn').classList.remove('border-slate-300', 'bg-white', 'text-slate-700');
                    return;
                }
            }
            
            // Check memory
            if (memoryApiKey) {
                document.getElementById('apiKey').value = memoryApiKey;
                document.getElementById('apiStatusText').textContent = `API Key å·²é…ç½® (${getSecurityLevelText()})`;
                document.getElementById('configApiBtn').classList.add('border-green-300', 'bg-green-50', 'text-green-700');
                document.getElementById('configApiBtn').classList.remove('border-slate-300', 'bg-white', 'text-slate-700');
            }
        }
        
        // Update API status
        function updateApiStatus() {
            const apiKey = document.getElementById('apiKey').value;
            const statusText = document.getElementById('apiStatusText');
            const configBtn = document.getElementById('configApiBtn');
            
            if (apiKey) {
                statusText.textContent = 'API Key å·²é…ç½®';
                configBtn.classList.add('border-green-300', 'bg-green-50', 'text-green-700');
                configBtn.classList.remove('border-slate-300', 'bg-white', 'text-slate-700');
            } else {
                statusText.textContent = 'é…ç½® DashScope API Key';
                configBtn.classList.add('border-slate-300', 'bg-white', 'text-slate-700');
                configBtn.classList.remove('border-green-300', 'bg-green-50', 'text-green-700');
            }
        }

        // Contract type selection
        document.querySelectorAll('.contract-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all buttons
                document.querySelectorAll('.contract-type-btn').forEach(b => {
                    b.classList.remove('border-purple-500', 'bg-purple-50');
                    b.classList.add('border-slate-200');
                });
                
                // Add active class to clicked button
                this.classList.remove('border-slate-200');
                this.classList.add('border-purple-500', 'bg-purple-50');
                
                selectedContractType = this.dataset.type;
            });
        });

        // Set default selection
        document.querySelector('[data-type="rental"]').click();

        // Load API Key on page load
        loadApiKey();

        // Tutorial Modal Events
        document.getElementById('tutorialBtn').addEventListener('click', function() {
            document.getElementById('tutorialModal').classList.remove('hidden');
        });

        document.getElementById('closeTutorialBtn').addEventListener('click', function() {
            document.getElementById('tutorialModal').classList.add('hidden');
        });

        document.getElementById('closeTutorialBtn2').addEventListener('click', function() {
            document.getElementById('tutorialModal').classList.add('hidden');
        });

        // Close tutorial modal when clicking outside
        document.getElementById('tutorialModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // API Configuration Modal Events
        document.getElementById('configApiBtn').addEventListener('click', function() {
            document.getElementById('apiModal').classList.remove('hidden');
            const currentApiKey = document.getElementById('apiKey').value;
            if (currentApiKey) {
                document.getElementById('modalApiKey').value = currentApiKey;
            }
        });

        document.getElementById('closeModalBtn').addEventListener('click', function() {
            document.getElementById('apiModal').classList.add('hidden');
        });

        // Save API Key
        document.getElementById('saveApiBtn').addEventListener('click', function() {
            const apiKey = document.getElementById('modalApiKey').value.trim();
            
            if (!apiKey) {
                alert('è¯·è¾“å…¥ API Key');
                return;
            }
            
            if (!apiKey.startsWith('sk-')) {
                alert('API Key æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä»¥ "sk-" å¼€å¤´');
                return;
            }
            
            const securityLevel = document.querySelector('input[name="securityLevel"]:checked').value;
            const encryptedKey = simpleEncrypt(apiKey);
            
            // Clear all previous storage
            sessionStorage.removeItem('contract_dashscope_api_key');
            localStorage.removeItem('contract_dashscope_api_key');
            memoryApiKey = null;
            
            // Save based on security level
            switch(securityLevel) {
                case 'session':
                    sessionStorage.setItem('contract_dashscope_api_key', encryptedKey);
                    break;
                case 'persistent':
                    localStorage.setItem('contract_dashscope_api_key', encryptedKey);
                    break;
                case 'memory':
                    memoryApiKey = apiKey;
                    break;
            }
            
            document.getElementById('apiKey').value = apiKey;
            document.getElementById('apiStatusText').textContent = `API Key å·²é…ç½® (${getSecurityLevelText()})`;
            document.getElementById('configApiBtn').classList.add('border-green-300', 'bg-green-50', 'text-green-700');
            document.getElementById('configApiBtn').classList.remove('border-slate-300', 'bg-white', 'text-slate-700');
            document.getElementById('apiModal').classList.add('hidden');
        });

        // Clear API Key
        document.getElementById('clearApiBtn').addEventListener('click', function() {
            sessionStorage.removeItem('contract_dashscope_api_key');
            localStorage.removeItem('contract_dashscope_api_key');
            memoryApiKey = null;
            
            document.getElementById('apiKey').value = '';
            document.getElementById('modalApiKey').value = '';
            updateApiStatus();
            document.getElementById('apiModal').classList.add('hidden');
        });

        // Drag and drop functionality
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('contract-upload');
        const uploadIcon = document.getElementById('uploadIcon');
        const uploadText = document.getElementById('uploadText');
        const dragText = document.getElementById('dragText');
        const fileName = document.getElementById('fileName');

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        // Highlight drop area when item is dragged over it
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        // Handle dropped files
        dropZone.addEventListener('drop', handleDrop, false);

        // Handle click to upload
        dropZone.addEventListener('click', () => {
            fileInput.click();
        });

        // Handle file input change
        fileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                handleFiles(e.target.files);
            }
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            dropZone.classList.add('border-purple-500', 'bg-purple-50');
            dropZone.classList.remove('border-slate-300');
            uploadIcon.classList.add('text-purple-600');
            uploadIcon.classList.remove('text-slate-400');
        }

        function unhighlight(e) {
            dropZone.classList.remove('border-purple-500', 'bg-purple-50');
            dropZone.classList.add('border-slate-300');
            uploadIcon.classList.remove('text-purple-600');
            uploadIcon.classList.add('text-slate-400');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            if (files.length > 0) {
                const file = files[0];
                
                // Validate file type
                const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'text/plain', 'image/jpeg', 'image/png', 'image/jpg'];
                const allowedExtensions = ['.pdf', '.doc', '.docx', '.txt', '.jpg', '.jpeg', '.png'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                
                if (!allowedTypes.includes(file.type) && !allowedExtensions.includes(fileExtension)) {
                    showError('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·ä¸Šä¼  PDFã€Wordã€å›¾ç‰‡æˆ–æ–‡æœ¬æ–‡ä»¶');
                    return;
                }
                
                // Validate file size
                if (file.size > 10 * 1024 * 1024) {
                    showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB');
                    return;
                }
                
                // Update UI to show selected file
                uploadText.textContent = 'å·²é€‰æ‹©æ–‡ä»¶';
                dragText.textContent = 'ç‚¹å‡»é‡æ–°é€‰æ‹©';
                fileName.textContent = file.name;
                fileName.classList.remove('hidden');
                
                // Update file input
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;
                
                // Change icon to indicate file is selected
                uploadIcon.setAttribute('data-lucide', 'file-check');
                uploadIcon.classList.add('text-green-600');
                uploadIcon.classList.remove('text-slate-400', 'text-purple-600');
                lucide.createIcons();
            }
        }

        // Form submission
        document.getElementById('contractForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('contract-upload');
            const contextInput = document.getElementById('context');
            const apiKeyInput = document.getElementById('apiKey');
            const errorMessage = document.getElementById('errorMessage');
            const loadingState = document.getElementById('loadingState');
            const resultsContent = document.getElementById('resultsContent');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            // Validate file
            if (!fileInput.files || fileInput.files.length === 0) {
                showError('è¯·å…ˆä¸Šä¼ åˆåŒæ–‡ä»¶');
                return;
            }

            const file = fileInput.files[0];
            if (file.size > 10 * 1024 * 1024) {
                showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB');
                return;
            }

            // Hide previous results and errors
            errorMessage.classList.add('hidden');
            resultsContent.classList.add('hidden');
            
            // Show loading state
            loadingState.classList.remove('hidden');
            analyzeBtn.classList.add('hidden');
            cancelBtn.classList.remove('hidden');

            try {
                // Create abort controller for cancellation
                abortController = new AbortController();

                const formData = new FormData();
                formData.append('contract', file);
                formData.append('contract_type', selectedContractType);
                formData.append('context', contextInput.value);
                if (apiKeyInput.value.trim()) {
                    formData.append('api_key', apiKeyInput.value.trim());
                }

                const response = await fetch('/analyze-contract', {
                    method: 'POST',
                    body: formData,
                    signal: abortController.signal
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'åˆ†æå¤±è´¥');
                }

                const data = await response.json();
                renderResults(data.analysis);

            } catch (error) {
                if (error.name === 'AbortError') {
                    showToast('åˆ†æå·²å–æ¶ˆ', 'info');
                } else {
                    console.error('åˆ†æé”™è¯¯:', error);
                    showError(error.message || 'åˆ†æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                }
            } finally {
                // Reset UI state
                loadingState.classList.add('hidden');
                analyzeBtn.classList.remove('hidden');
                cancelBtn.classList.add('hidden');
                abortController = null;
            }
        });

        // Cancel button
        document.getElementById('cancelBtn').addEventListener('click', function() {
            if (abortController) {
                abortController.abort();
                showToast('æ­£åœ¨å–æ¶ˆåˆ†æ...', 'info');
            }
        });

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function renderResults(analysis) {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.classList.remove('hidden');
            
            // Scroll to results
            resultsContent.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Render contract summary
            renderContractSummary(analysis.contract_summary);
            
            // Render risk analysis
            renderRiskAnalysis(analysis.risks);
            
            // Render plain language explanation
            renderPlainExplanation(analysis.plain_explanations);
            
            // Render suggestions
            renderSuggestions(analysis.suggestions);
        }

        function renderContractSummary(summary) {
            const container = document.getElementById('contractSummary');
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <div class="text-sm text-slate-600 mb-1">åˆåŒç±»å‹</div>
                        <div class="font-medium text-slate-900">${summary.contract_type || 'æœªè¯†åˆ«'}</div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <div class="text-sm text-slate-600 mb-1">é£é™©ç­‰çº§</div>
                        <div class="font-medium ${getRiskClass(summary.overall_risk)}">${summary.overall_risk || 'æœªè¯„ä¼°'}</div>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                    <div class="text-sm text-slate-600 mb-2">åˆåŒè¦ç‚¹</div>
                    <div class="text-slate-900">${summary.key_points || 'æ­£åœ¨åˆ†æ...'}</div>
                </div>
            `;
        }

        function renderRiskAnalysis(risks) {
            const container = document.getElementById('riskAnalysis');
            if (!risks || risks.length === 0) {
                container.innerHTML = '<p class="text-slate-500">æœªå‘ç°æ˜æ˜¾é£é™©</p>';
                return;
            }

            container.innerHTML = risks.map(risk => `
                <div class="border rounded-lg p-4 ${getRiskBorderClass(risk.level)}">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                            <i data-lucide="${getRiskIcon(risk.level)}" class="h-5 w-5 ${getRiskIconClass(risk.level)}"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-slate-900 mb-2">${risk.title}</h4>
                            <p class="text-slate-700 mb-3">${risk.description}</p>
                            <div class="text-sm ${getRiskClass(risk.level)} font-medium">
                                é£é™©ç­‰çº§ï¼š${risk.level}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function renderPlainExplanation(explanations) {
            const container = document.getElementById('plainExplanation');
            if (!explanations || explanations.length === 0) {
                container.innerHTML = '<p class="text-slate-500">æš‚æ— éœ€è¦ç‰¹åˆ«è§£é‡Šçš„æ¡æ¬¾</p>';
                return;
            }

            container.innerHTML = explanations.map(explanation => `
                <div class="border border-slate-200 rounded-lg p-4">
                    <h4 class="font-medium text-slate-900 mb-2">${explanation.clause_title}</h4>
                    <div class="bg-slate-50 p-3 rounded-lg mb-3">
                        <div class="text-sm text-slate-600 mb-1">åŸæ–‡æ¡æ¬¾ï¼š</div>
                        <div class="text-slate-800 text-sm italic">"${explanation.original_text}"</div>
                    </div>
                    <div class="text-slate-700">
                        <div class="text-sm text-slate-600 mb-1">é€šä¿—è§£é‡Šï¼š</div>
                        <div>${explanation.plain_explanation}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderSuggestions(suggestions) {
            const container = document.getElementById('suggestions');
            if (!suggestions || suggestions.length === 0) {
                container.innerHTML = '<p class="text-slate-500">æš‚æ— ç‰¹åˆ«å»ºè®®</p>';
                return;
            }

            container.innerHTML = suggestions.map((suggestion, index) => `
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0 w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center">
                        <span class="text-xs font-medium text-yellow-700">${index + 1}</span>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-medium text-slate-900 mb-1">${suggestion.title}</h4>
                        <p class="text-slate-700">${suggestion.content}</p>
                    </div>
                </div>
            `).join('');
        }

        function getRiskClass(level) {
            switch(level) {
                case 'é«˜é£é™©': return 'text-red-600';
                case 'ä¸­é£é™©': return 'text-yellow-600';
                case 'ä½é£é™©': return 'text-green-600';
                default: return 'text-slate-600';
            }
        }

        function getRiskBorderClass(level) {
            switch(level) {
                case 'é«˜é£é™©': return 'border-red-200 bg-red-50';
                case 'ä¸­é£é™©': return 'border-yellow-200 bg-yellow-50';
                case 'ä½é£é™©': return 'border-green-200 bg-green-50';
                default: return 'border-slate-200 bg-slate-50';
            }
        }

        function getRiskIcon(level) {
            switch(level) {
                case 'é«˜é£é™©': return 'alert-triangle';
                case 'ä¸­é£é™©': return 'alert-circle';
                case 'ä½é£é™©': return 'info';
                default: return 'help-circle';
            }
        }

        function getRiskIconClass(level) {
            switch(level) {
                case 'é«˜é£é™©': return 'text-red-500';
                case 'ä¸­é£é™©': return 'text-yellow-500';
                case 'ä½é£é™©': return 'text-green-500';
                default: return 'text-slate-500';
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            let bgColor, icon;
            
            switch(type) {
                case 'success':
                    bgColor = 'bg-emerald-500';
                    icon = 'check';
                    break;
                case 'error':
                    bgColor = 'bg-red-500';
                    icon = 'x-circle';
                    break;
                case 'info':
                    bgColor = 'bg-blue-500';
                    icon = 'info';
                    break;
                default:
                    bgColor = 'bg-emerald-500';
                    icon = 'check';
            }
            
            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg z-50 flex items-center transform transition-all duration-300 translate-x-full`;
            toast.innerHTML = `<i data-lucide="${icon}" class="h-4 w-4 mr-2"></i>${message}`;
            document.body.appendChild(toast);
            
            // Initialize lucide icons for the toast
            lucide.createIcons();
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 2000);
        }
    </script>
</body>
</html>
